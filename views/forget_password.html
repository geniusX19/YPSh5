<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<title>壹客送</title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/style.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/iconfont.css" />
		<style>
			html,body,.mui-content{
				height: 92%;
			}
			.area {
				margin: 20px auto 0px auto;
			}
			
			.mui-input-group:first-child {
				margin-top: 20px;
			}
			
			.mui-input-group label {
				width: 22%;
			}
			
			.mui-input-row label~input,
			.mui-input-row label~select,
			.mui-input-row label~textarea {
				width: 78%;
			}
			
			.mui-checkbox input[type=checkbox],
			.mui-radio input[type=radio] {
				top: 6px;
			}
			
			.mui-content-padded {
				margin-top: 25px;
			}
			
			.mui-btn {
				padding: 10px;
			}
			
			.mui-input-row label~input,
			.mui-input-row label~select,
			.mui-input-row label~textarea {
				margin-top: 1px;
			}
			#sms_div .mui-icon-clear {
				right: 110px !important;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">密码找回</h1>
		</header>
		<div class="mui-content" id="dcontent">
			<div style="" align="center">
				<img src="../images/logo.png" style="margin-top:25px;" />
			</div>
			<form class="mui-input-group" style="margin-top: 20px;">
				<div class="mui-input-row show_1">
					<label><span class="mui-icon iconfont icon-phone" style="color: orangered;margin-left: 3px;font-size: 18px;"></span></label>
					<input id='phonenumber' type="text" class=" mui-input" placeholder="请输入手机号">
				</div>
				<div class="mui-input-row show_1" id="sms_div">
					<label><span class="mui-icon iconfont icon-yanzhengma"style="color: orangered;margin-left: 3px;font-size: 18px;"></span></label>
					<input id='sms' type="text" class=" mui-input" placeholder="请输入验证码" style="width:40% ;float: left;">
					<div style="margin-top: 9px;float: right;margin-right: 8px;">
						<a href="#" style="font-size: 15px;color: orangered;" id="btn_sms">获取验证码</a>
					</div>
				</div>
				<div class="mui-input-row hidden_1" style="">
					<label><span class="mui-icon mui-icon-locked" style="color: orangered;margin-left: 3px;font-size: 18px;"></span></label>
					<input id='password' type="password" class=" mui-input" placeholder="请输入新密码">
				</div>
				<div class="mui-input-row hidden_1" style="">
					<label><span class="mui-icon mui-icon-locked" style="color: orangered;margin-left: 3px;font-size: 18px;"></span></label>
					<input id='againPassword' type="password" class=" mui-input" placeholder="请再次输入密码">
				</div>

			</form>
			<div class="mui-content-padded" align="center">
				<button id='submit' data-loading-text="提交中..." data-loading-icon="" class="mui-btn" style="color: orangered;font-size: 20px;font-family: '微软雅黑';width: 260px;">提交</button>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/mui.enterfocus.js"></script>
		<script src="../js/app.js"></script>
		<script src="../js/config.js"></script>
		<script type="text/javascript" src="../js/immersed.js" ></script>
		<script type="text/javascript" src="../js/timer.js"></script>

		<script>
			var flag = 1;
			var phone;
			mui.init();
			mui.plusReady(function() {
				var  button =document.getElementById('submit');
				//检查手机号
				document.getElementById('phonenumber').addEventListener('change', function() {
					if(!app.checkPhone(this.value)) {
						mui.toast('请输入正确的手机号')
					}
				});
				/**
				 * 发送短信
				 */
				document.getElementById('btn_sms').addEventListener('tap', function() {
					var phone = document.getElementById("phonenumber").value;
					var res = app.checkPhone(phone);
					if(res == false) {
						plus.nativeUI.toast("请输入正确的手机号");
						return;
					}
					//发送短信按键增加一个点击事件
					app.getSms(phone);
					setSeconds(this, 150);
				});
				document.getElementById('password').addEventListener('change', function() {
					if(this.value.length < 6 || this.value.length > 24) {
						mui.toast('请输入6~24位密码')
					}
				});
				document.getElementById('againPassword').addEventListener('change', function() {
					var password = document.getElementById("password").value;
					if(password != this.value) {
						mui.toast('两次输入的密码不一致');
					}
				});
				button.addEventListener('tap', function() {
					var phonenumber = document.getElementById("phonenumber").value;
					var smsCode = document.getElementById("sms").value;
					var password = document.getElementById("password").value;
					var againPassword = document.getElementById("againPassword").value;
					if(!app.checkPhone(phonenumber)) {
						mui.toast('请输入正确的手机号');
						return;
					}
					if(!smsCode) {
						mui.toast('验证码不能为空');
						return;
					}
					if(!password) {
						mui.toast('请输入6~24位密码');
						return;
					}
					if((password != againPassword)) {
						mui.toast('两次输入的密码不一致');
						return;
					}
					mui(button).button("loading");
					mui.ajax(API_CHANGE_PASSWORD, {
						data: {
							"phonenumber": phonenumber,
							"smsCode": smsCode,
							"password": password,
							"againPassword": againPassword
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'post', //HTTP请求类型
						timeout: 10000, //超时时间设置为10秒；
						crossDomain: true,
						headers:{'Content-Type':'application/json'},	              
						success: function(data) {
							mui(button).button("reset");
							if(data.status == 1) {
								mui.toast('修改成功');
								app.openWebView("../login.html", "login");
							} else {
								mui.toast(data.msg);
							}
						},
						error: function(xhr, type, errorThrown) {
							mui(button).button("reset");
							mui.toast('修改失败');
						}
					});
				})
			});
		</script>
	</body>

</html>