<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/showLoading.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link rel="stylesheet" href="../../css/couponCommon.css" />
	</head>
	<style>
		html,
		body,
		.mui-content{
			width: 100%;
			height: 95%;
		}
		em{
			color: #C9302C;
		}
	</style>

	<body>
		<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">红包</h1>
		</header>
		<div class="mui-content" id="dcontent" >
			<div id="content" style="min-height:300px;width: 100%;">
			</div>
			<div style="width: 100%;" align="center">
				<div style="font-size: 13px;margin-top: 5px;margin-bottom: 5px;color: gray;">我是有底线的~</div>
				<div class="footer" style="height: 20px;font-size: 11px;color: gray;" align="center">
					<span id="history">查看红包记录</span> | <span id="explain">红包说明</span>
				</div>
			</div>
		</div>
		<script src="../../js/mui.js"></script>
		<script type="text/javascript" src="../../js/app.js"></script>
		<script type="text/javascript" src="../../js/myStorage.js"></script>
		<script type="text/javascript" src="../../js/config.js"></script>
		<script type="text/javascript" src="../../js/immersed.js"></script>
		<script type="text/javascript" src="../../js/showLoading.js"></script>
		<script type="text/javascript">
			mui.init()
			var contentDiv;
			
			/**
			 * 模板
			 * @param {Object} id  红包id
			 * @param {Object} couponPrice 红包的价格
			 * @param {Object} min  使用的最低价格说明
			 * @param {Object} name 红包名称
			 * @param {Object} expireDate  到期时间
			 * @param {String} type 红包类型
			 */
			function couponTemplate(id, couponPrice, min, name, expireDate,type) {
				var template = '<div class="template"><input type="hidden" value="' + id +
					'" class="ss"/><div class="price-area"><div  align="center"><div class="" style="color: red;"><span style="font-size: 13px;">¥</span><b style="font-size: 25px; vertical-align: calc(-8px);"class="price">' +
					+couponPrice + '</b></div><div class="restrict">' + min + '</div></div></div><div class="name-area"><div><b class="name" style="font-size: 15px;">' + name + '</b></div><div style="font-size: 10px;font-style: italic;color: gray;line-height:19px;"><span class="expire-time">' + expireDate + '</span>到期	<br><em>'+app.getCouponType(type)+'</em></div></div><div class="result-area" ><button type="button" class="mui-btn mui-btn-blue" style="border:none;font-size: 12px!important;border-radius:20px;color: white; margin-top: 22px;">去使用</button></div></div>';
				return template
			}
			mui.plusReady(function() {
				var height = (plus.display.resolutionHeight - 120)+"px";
				contentDiv = document.getElementById("content");
				contentDiv.style.minHeight = height;
				app.tokenAjax_Get({
					url: API_URL_GET_CAN_USE_ALL_COUPON_LIST + app.getCustomerId(),
					success: function(result) {
						if(result.status == 1) {
							var data = result.data;
							mui.each(data, function(index, element) {
								var minprice = element.minPrice;
								var min;
								if(minprice <= 8) {
									min = "满任意金额可用";
								} else {
									min = "满" + minprice + "元可用"
								}
								var div = couponTemplate(element.couponId, element.couponPrice, min, element.couponName, element.expireDate,element.couponType);
								contentDiv.innerHTML = contentDiv.innerHTML + div;
							})
						}
					},
					error: function(xhr) {
						app.httpError(xhr.status);
					}
				});

				mui('.mui-content').on('tap', '.mui-btn', function() {
					app.openWebView("../order.html", "order");
				})

				document.getElementById('history').addEventListener('tap', function() {
					app.openWebView("redPacketHistory.html", "redPacketHistory");
				})
				document.getElementById('explain').addEventListener('tap', function() {
					app.openWebView("hongbaoExplain.html", "hongbaoExplain");
				})
			})
		</script>
	</body>

</html>